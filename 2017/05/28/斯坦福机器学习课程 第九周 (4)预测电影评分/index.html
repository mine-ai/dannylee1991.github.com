<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="机器学习,斯坦福课程," />





  <link rel="alternate" href="/rss2.xml" title="studyAI" type="application/atom+xml" />






<meta name="description" content="预测电影评分Simple inline $a = b + c$.
问题制定视频地址
在接下来的内容中，我想介绍给你们有关推荐系统(recommender systems)的内容。
我想讨论推荐系统有两个原因：

原因一：对工业界有至关重要的作用
  在过去的几年中，我有时会去参观硅谷的各种科技类公司。我经常在那些公司里与开发机器学习应用的人交流。然后我问他们什么才是机器学习最重要的应用？或者什么样">
<meta property="og:type" content="article">
<meta property="og:title" content="斯坦福机器学习课程 第九周 (4)预测电影评分">
<meta property="og:url" content="http://studyai.site/2017/05/28/斯坦福机器学习课程 第九周 (4)预测电影评分/index.html">
<meta property="og:site_name" content="studyAI">
<meta property="og:description" content="预测电影评分Simple inline $a = b + c$.
问题制定视频地址
在接下来的内容中，我想介绍给你们有关推荐系统(recommender systems)的内容。
我想讨论推荐系统有两个原因：

原因一：对工业界有至关重要的作用
  在过去的几年中，我有时会去参观硅谷的各种科技类公司。我经常在那些公司里与开发机器学习应用的人交流。然后我问他们什么才是机器学习最重要的应用？或者什么样">
<meta property="og:image" content="http://studyai.site/img/17_05_28/001.png">
<meta property="og:image" content="http://studyai.site/img/17_05_28/002.gif">
<meta property="og:image" content="http://studyai.site/img/17_05_28/003.gif">
<meta property="og:image" content="http://studyai.site/img/17_05_28/003.gif">
<meta property="og:image" content="http://studyai.site/img/17_05_28/004.gif">
<meta property="og:image" content="http://studyai.site/img/17_05_28/004.gif">
<meta property="og:image" content="http://studyai.site/img/17_05_28/005.gif">
<meta property="og:image" content="http://studyai.site/img/17_05_28/006.gif">
<meta property="og:image" content="http://studyai.site/img/17_05_28/007.gif">
<meta property="og:image" content="http://studyai.site/img/17_05_28/008.gif">
<meta property="og:image" content="http://studyai.site/img/17_05_28/004.gif">
<meta property="og:image" content="http://studyai.site/img/17_05_28/008.gif">
<meta property="og:image" content="http://studyai.site/img/17_05_28/009.gif">
<meta property="og:image" content="http://studyai.site/img/17_05_28/010.gif">
<meta property="og:image" content="http://studyai.site/img/17_05_28/004.gif">
<meta property="og:image" content="http://studyai.site/img/17_05_28/008.gif">
<meta property="og:image" content="http://studyai.site/img/17_05_28/011.gif">
<meta property="og:image" content="http://studyai.site/img/17_05_28/012.gif">
<meta property="og:image" content="http://studyai.site/img/17_05_28/009.gif">
<meta property="og:image" content="http://studyai.site/img/17_05_28/013.gif">
<meta property="og:image" content="http://studyai.site/img/17_05_28/009.gif">
<meta property="og:image" content="http://studyai.site/img/17_05_28/014.gif">
<meta property="og:image" content="http://studyai.site/img/17_05_28/004.gif">
<meta property="og:image" content="http://studyai.site/img/17_05_28/008.gif">
<meta property="og:image" content="http://studyai.site/img/17_05_28/009.gif">
<meta property="og:image" content="http://studyai.site/img/17_05_28/004.gif">
<meta property="og:image" content="http://studyai.site/img/17_05_28/008.gif">
<meta property="og:image" content="http://studyai.site/img/17_05_28/009.gif">
<meta property="og:image" content="http://studyai.site/img/17_05_28/010.gif">
<meta property="og:image" content="http://studyai.site/img/17_05_28/015.png">
<meta property="og:image" content="http://studyai.site/img/17_05_28/016.png">
<meta property="og:image" content="http://studyai.site/img/17_05_28/017.png">
<meta property="og:image" content="http://studyai.site/img/17_05_28/009.gif">
<meta property="og:updated_time" content="2017-10-31T11:19:26.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="斯坦福机器学习课程 第九周 (4)预测电影评分">
<meta name="twitter:description" content="预测电影评分Simple inline $a = b + c$.
问题制定视频地址
在接下来的内容中，我想介绍给你们有关推荐系统(recommender systems)的内容。
我想讨论推荐系统有两个原因：

原因一：对工业界有至关重要的作用
  在过去的几年中，我有时会去参观硅谷的各种科技类公司。我经常在那些公司里与开发机器学习应用的人交流。然后我问他们什么才是机器学习最重要的应用？或者什么样">
<meta name="twitter:image" content="http://studyai.site/img/17_05_28/001.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.3',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://studyai.site/2017/05/28/斯坦福机器学习课程 第九周 (4)预测电影评分/"/>





  <title>斯坦福机器学习课程 第九周 (4)预测电影评分 | studyAI</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?64d3554e2db8268ff4e020b47928563f";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">studyAI</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://studyai.site/2017/05/28/斯坦福机器学习课程 第九周 (4)预测电影评分/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="DannyLee1991">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="studyAI">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">斯坦福机器学习课程 第九周 (4)预测电影评分</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-28T08:44:00+08:00">
                2017-05-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/机器学习/" itemprop="url" rel="index">
                    <span itemprop="name">机器学习</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/05/28/斯坦福机器学习课程 第九周 (4)预测电影评分/" class="leancloud_visitors" data-flag-title="斯坦福机器学习课程 第九周 (4)预测电影评分">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="预测电影评分"><a href="#预测电影评分" class="headerlink" title="预测电影评分"></a>预测电影评分</h1><p>Simple inline $a = b + c$.</p>
<h2 id="问题制定"><a href="#问题制定" class="headerlink" title="问题制定"></a>问题制定</h2><p><a href="https://www.coursera.org/learn/machine-learning/lecture/Rhg6r/problem-formulation" target="_blank" rel="external">视频地址</a></p>
<p>在接下来的内容中，我想介绍给你们有关<strong>推荐系统(recommender systems)</strong>的内容。</p>
<p>我想讨论推荐系统有两个原因：</p>
<ul>
<li><p><strong>原因一：对工业界有至关重要的作用</strong></p>
<p>  在过去的几年中，我有时会去参观硅谷的各种科技类公司。我经常在那些公司里与开发机器学习应用的人交流。然后我问他们什么才是机器学习最重要的应用？或者什么样的机器学习的应用是你最想让它的表现得到改进的？我最常听到的回答其中之一就是 现在硅谷有好多个团队正试图建立更好的推荐系统。</p>
<p>  亚马逊、Netflix、eBay又或者苹果公司的iTunes Genius等，很多网站或者很多系统，试图向用户推荐新产品。比如说亚马逊向你推荐新书，Netflix 向你推荐新电影…。而这些推荐系统可能会看看你以前购买过什么书，或者以前你给哪些电影进行过评分。</p>
<p>  这些系统贡献了现今亚马逊收入的相当大一部分。而对像Netflix这样的公司，他们向用户推荐的电影占了用户观看的电影的相当大一部分。于是一个推荐系统其表现的一些改进，就能带来显著且即刻产生的影响。这种影响关系到许多公司的最终业绩。</p>
<p>  推荐系统在机器学习学术界是个很有意思的问题。如果我们去参加一个学术类的机器学习会议，<br>推荐系统的问题几乎得不到什么关注至少它是学术界当前动向里较小的一部分。但如果你看看正在发生的事对很多科技类公司而言，建立这些推荐系统似乎是优先要办的事。这就是我想在这门课中谈论推荐系统的原因之一。</p>
</li>
<li><p><strong>原因二：自动学习到优良特征</strong></p>
<p>  对于机器学习来说，特征量是重要的。你选择的特征对你学习算法的表现有很大影响。</p>
<p>  在机器学习领域有这么一个宏大的想法，就是对于一些问题而言（可能不是所有问题），存在一些算法能<strong>试图自动地替你学习到一组优良的特征量</strong>。这样与其手动设计或者手动编写特征，你或许能够采用一种算法来自动学习到使用什么特征量。而推荐系统就是这种情形的一个例子。</p>
</li>
</ul>
<h3 id="推荐系统-问题表述"><a href="#推荐系统-问题表述" class="headerlink" title="推荐系统 问题表述"></a>推荐系统 问题表述</h3><p>以预测电影评分这个时兴的问题为例，假想你是一个销售或出租电影的网站，你让用户使用1至5颗星 给不同的电影评分：</p>
<p><img src="/img/17_05_28/001.png" alt=""></p>
<p>假设下面的表格是几个用户针对五部电影给出的评分。其中”?”代表用户没有给出评分：</p>
<table>
<thead>
<tr>
<th style="text-align:center">电影</th>
<th style="text-align:center">Alice(1)</th>
<th style="text-align:center">Bob(2)</th>
<th style="text-align:center">Carol(3)</th>
<th style="text-align:center">Dave(4)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">《爱到最后》</td>
<td style="text-align:center">5</td>
<td style="text-align:center">5</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">《浪漫永远》</td>
<td style="text-align:center">5</td>
<td style="text-align:center">?</td>
<td style="text-align:center">?</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">《小爱犬》</td>
<td style="text-align:center">?</td>
<td style="text-align:center">4</td>
<td style="text-align:center">0</td>
<td style="text-align:center">?</td>
</tr>
<tr>
<td style="text-align:center">《无尽狂飙》</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">5</td>
<td style="text-align:center">4</td>
</tr>
<tr>
<td style="text-align:center">《剑与空手道》</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">5</td>
<td style="text-align:center">?</td>
</tr>
</tbody>
</table>
<p>引入以下几个变量：</p>
<p>$$<br>n_u=用户数量 \\<br>n_m=电影数量 \\<br>r(i,j)=如果用户j对电影i投过票，则记为1 \\<br>y^{(i,j)}=用户j对电影i投票的分值（只有在r(i,j)=1时，才有这个值）<br>$$</p>
<p>推荐系统问题就是：</p>
<p>在给定上面的这些数据（即$r(i,j)$和$y^{(i,j)}$）时，然后视图去预测上面表格中那些”?”的值。这样我们就可以向用户推荐他们可能还没看过的新电影了。</p>
<h2 id="基于内容的推荐"><a href="#基于内容的推荐" class="headerlink" title="基于内容的推荐"></a>基于内容的推荐</h2><p><a href="https://www.coursera.org/learn/machine-learning/lecture/uG59z/content-based-recommendations" target="_blank" rel="external">视频地址</a></p>
<blockquote>
<p>上一节，我们引出了<strong>推荐系统</strong>的问题，这一节，我将介绍一种<strong>基于内容的推荐</strong>方法。</p>
</blockquote>
<p>这是上一节中的数据：</p>
<table>
<thead>
<tr>
<th style="text-align:center">电影</th>
<th style="text-align:center">Alice(1)</th>
<th style="text-align:center">Bob(2)</th>
<th style="text-align:center">Carol(3)</th>
<th style="text-align:center">Dave(4)</th>
<th style="text-align:center">$x_1$(爱情片)</th>
<th style="text-align:center">$x_2$(动作片)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">《爱到最后》</td>
<td style="text-align:center">5</td>
<td style="text-align:center">5</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0.9</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">《浪漫永远》</td>
<td style="text-align:center">5</td>
<td style="text-align:center">?</td>
<td style="text-align:center">?</td>
<td style="text-align:center">0</td>
<td style="text-align:center">1.0</td>
<td style="text-align:center">0.01</td>
</tr>
<tr>
<td style="text-align:center">《小爱犬》</td>
<td style="text-align:center">?</td>
<td style="text-align:center">4</td>
<td style="text-align:center">0</td>
<td style="text-align:center">?</td>
<td style="text-align:center">0.99</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">《无尽狂飙》</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">5</td>
<td style="text-align:center">4</td>
<td style="text-align:center">0.1</td>
<td style="text-align:center">1.0</td>
</tr>
<tr>
<td style="text-align:center">《剑与空手道》</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">5</td>
<td style="text-align:center">?</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0.9</td>
</tr>
</tbody>
</table>
<p>重申一下之前的定义：</p>
<p>$$<br>n_u=用户数量 \\<br>n_m=电影数量 \\<br>r(i,j)=如果用户j对电影i投过票，则记为1 \\<br>y^{(i,j)}=用户j对电影i投票的分值（只有在r(i,j)=1时，才有这个值）<br>$$</p>
<p>在这里的数据中：</p>
<p>$$<br>n_u=4 \\<br>n_m=5<br>$$</p>
<p>并且我们又追加了两列特征$x_1$和$x_2$，分别表示当前电影属于<strong>爱情片</strong>和<strong>动作片</strong>的程度。我们用$n=2$来代表特征数（这里不包括$x_0$）。</p>
<p>有了每部电影的类型特征数据，我们就可以用一个特征矩阵表示某一部电影了。假设上面五部电影，从上到下我们依次使用数字$1、2、3、4、5$来代替。那么对于第一部电影《爱到最后》的特征向量表示为：</p>
<p>$$<br>\begin{equation}<br>x^{(1)}=\left[<br>\begin{matrix}<br>1\\<br>0.9\\<br>0<br>\end{matrix}<br>\right]<br>\end{equation}<br>$$</p>
<blockquote>
<p>这三个数分别代表三个特征的值:$x_0$、$x_1$和$x_2$。其中$x_0$是截距特征变量，值为1。</p>
</blockquote>
<h3 id="使用一个已经训练好的模型进行预测"><a href="#使用一个已经训练好的模型进行预测" class="headerlink" title="使用一个已经训练好的模型进行预测"></a>使用一个已经训练好的模型进行预测</h3><p>为了进行预测，我们可以把对每个观众打分的预测当成一个独立的线性回归问题。</p>
<p>具体来说，比如每一个用户$j$，都学习出一个参数$\theta^{(j)}$（一般情况下，$\theta^{(j)}$的维度都是$n+1$，$n$是特征数，不包括截距项$x_0$）。</p>
<p>然后我们要根据参数向量$\theta^{(j)}$与特征$x^{(i)}$的内积来预测用户对电影$i$的评分：</p>
<p>$$<br>(\theta^{(j)})^Tx^{(i)}<br>$$</p>
<h4 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h4><p>我们以用户1 Alice为例，Alice对应的特征向量应该是$\theta^{(1)}$，我们要预测Alice对于电影《小爱犬》的评分，这部电影的特征向量为：</p>
<p>$$<br>\begin{equation}<br>x^{(3)}=\left[<br>\begin{matrix}<br>1\\<br>0.99\\<br>0<br>\end{matrix}<br>\right]<br>\end{equation}<br>$$</p>
<p>假如你已经得到了Alice的特征参数向量$\theta^{(1)}$的值（后面我们会具体讲如何得到这个值）：</p>
<p>$$<br>\begin{equation}<br>\theta^{(1)}=\left[<br>\begin{matrix}<br>0\\<br>5\\<br>0<br>\end{matrix}<br>\right]<br>\end{equation}<br>$$</p>
<p>那么对于Alice关于《小爱犬》的平分预测如下：</p>
<p>$$<br>(\theta^{(1)})^Tx^{(3)}=5×0.99=4.95<br>$$</p>
<p>这里我们实际在做的事情就是：<strong>对每个用户应用不同的线性回归模型</strong>。</p>
<h3 id="更正式的描述"><a href="#更正式的描述" class="headerlink" title="更正式的描述"></a>更正式的描述</h3><p>关于这个计算过程，更正式的描述如下：</p>
<p>已知：</p>
<p>$$<br>r(i,j)=如果用户j对电影i投过票，则记为1 \\<br>y^{(i,j)}=用户j对电影i投票的分值（只有在r(i,j)=1时，才有这个值）\\<br>\theta^{(j)} = 用户j的参数向量 \\<br>x^{(i)} = 电影i的特征向量<br>$$</p>
<p>对于用户$j$关于电影$i$的预测评分为：</p>
<p>$$<br>(\theta^{(j)})^Tx^{(i)}<br>$$</p>
<h3 id="训练预测模型：计算参数向量-theta"><a href="#训练预测模型：计算参数向量-theta" class="headerlink" title="训练预测模型：计算参数向量$\theta$"></a>训练预测模型：计算参数向量$\theta$</h3><p>通过以下运算，可以学习到参数$\theta^{(j)}$：</p>
<p><img src="/img/17_05_28/002.gif" alt=""></p>
<blockquote>
<p><strong>公式解读：</strong></p>
<p>其中$\sum_{i:r(i,j)=1}$代表对所有满足$r(i,j)=1$的元素进行求和。</p>
<p>$(\theta^{(j)})^T(x^{(i)})-y^{(i,j)}$代表预测用户$j$对电影$i$的平分减去用户对这部电影的实际评分。</p>
<p>$\frac{\lambda}{2m^{(j)}}\sum_{k=1}^n((\theta_k^{(j)}))^2$是正则化项。</p>
</blockquote>
<p>对上面的式子通过求最小化，我们最终可以得到一个表现良好的$\theta^{(j)}$。</p>
<p>为了让公式变得更简单一些，我们可以去除掉常数项$\frac{1}{m^{(j)}}$，对最终结果无影响：</p>
<p><img src="/img/17_05_28/003.gif" alt=""></p>
<h4 id="完整的描述"><a href="#完整的描述" class="headerlink" title="完整的描述"></a>完整的描述</h4><p>接下来对训练过程进行完整的描述一遍：</p>
<h5 id="优化目标"><a href="#优化目标" class="headerlink" title="优化目标"></a>优化目标</h5><p>为了学习第$j$个用户的参数$\theta^{(j)}$，我们执行以下运算：</p>
<p><img src="/img/17_05_28/003.gif" alt=""></p>
<p>为了学习全部用户的参数$\theta^{(1)},\theta^{(2)},…,\theta^{(n_u)}$，我们执行以下运算：</p>
<p><img src="/img/17_05_28/004.gif" alt=""></p>
<p>通过这一运算，我们就能得出所有用户的参数向量$\theta^{(1)},\theta^{(2)},…,\theta^{(n_u)}$，从而对所有用户作出预测了。</p>
<h5 id="优化算法"><a href="#优化算法" class="headerlink" title="优化算法"></a>优化算法</h5><p><img src="/img/17_05_28/004.gif" alt=""></p>
<p>是我们最优化目标，记为$J(\theta^{(1)},\theta^{(2)},…,\theta^{(n_u)})$。</p>
<p>为了最小化这个目标函数$J(\theta^{(1)},\theta^{(2)},…,\theta^{(n_u)})$，我们需要使用梯度下降算法来计算：</p>
<ul>
<li><strong>k=0时</strong></li>
</ul>
<p><img src="/img/17_05_28/005.gif" alt=""></p>
<ul>
<li><strong>k≠0时</strong></li>
</ul>
<p><img src="/img/17_05_28/006.gif" alt=""></p>
<blockquote>
<p><strong>注意：</strong>其中$\alpha$是学习率。</p>
</blockquote>
<p>上面的过程实际上是在对优化目标函数$J(\theta^{(1)},\theta^{(2)},…,\theta^{(n_u)})$求偏微分的过程：</p>
<p>$$<br>\frac{\partial}{\partial\theta_k^{j}}<br>J(\theta^{(1)},\theta^{(2)},…,\theta^{(n_u)})<br>$$</p>
<p>以上就是通过梯度下降来最小化代价函数$J$的全过程，当然，如果你愿意的话，你可以尝试使用更高级的优化算比如<strong>聚类下降</strong>或者<em>L-BFGS(Limited-memory Broyden–Fletcher–Goldfarb–Shanno Algorithm)*</em>或者别的方法来最小化代价函数J。</p>
<blockquote>
<p>以上内容，我们介绍了使用一种线性回归的变体来预测不同用户对不同电影评分的算法，这种算法被称作<strong>“基于内容的推荐”</strong>，因为我们已知了不同电影的特征（比如电影是爱情片的程度，是动作片的程度等），从而来进行预测。但事实上，对于很多电影，我们并没有这些特征，或者很难得到这些特征。所以，在下一节中，我们将介绍一种<strong>“不基于内容的推荐系统”</strong>。</p>
</blockquote>
<h1 id="协同过滤"><a href="#协同过滤" class="headerlink" title="协同过滤"></a>协同过滤</h1><h2 id="协同过滤-1"><a href="#协同过滤-1" class="headerlink" title="协同过滤"></a>协同过滤</h2><p><a href="https://www.coursera.org/learn/machine-learning/lecture/2WoBV/collaborative-filtering" target="_blank" rel="external">视频地址</a></p>
<blockquote>
<p>这一节，我们将介绍一种叫做<strong>协同过滤(collaborative filtering)</strong>的推荐算法。</p>
<p>关于这个算法值得一提的一个特点，那就是它能实现<strong>对特征的学习</strong>。就是说这个算法可以实现自动学习要使用的特征值。</p>
</blockquote>
<p>在之前的电影评分的例子中，我们有下面的这组数据：</p>
<table>
<thead>
<tr>
<th style="text-align:center">电影</th>
<th style="text-align:center">Alice(1)</th>
<th style="text-align:center">Bob(2)</th>
<th style="text-align:center">Carol(3)</th>
<th style="text-align:center">Dave(4)</th>
<th style="text-align:center">$x_1$(爱情片)</th>
<th style="text-align:center">$x_2$(动作片)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">《爱到最后》</td>
<td style="text-align:center">5</td>
<td style="text-align:center">5</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0.9</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">《浪漫永远》</td>
<td style="text-align:center">5</td>
<td style="text-align:center">?</td>
<td style="text-align:center">?</td>
<td style="text-align:center">0</td>
<td style="text-align:center">1.0</td>
<td style="text-align:center">0.01</td>
</tr>
<tr>
<td style="text-align:center">《小爱犬》</td>
<td style="text-align:center">?</td>
<td style="text-align:center">4</td>
<td style="text-align:center">0</td>
<td style="text-align:center">?</td>
<td style="text-align:center">0.99</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">《无尽狂飙》</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">5</td>
<td style="text-align:center">4</td>
<td style="text-align:center">0.1</td>
<td style="text-align:center">1.0</td>
</tr>
<tr>
<td style="text-align:center">《剑与空手道》</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">5</td>
<td style="text-align:center">?</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0.9</td>
</tr>
</tbody>
</table>
<p>我们除了有每个用户对不同电影的评分之外，同时也有每个电影属于不同类别特征的程度值$x_1$和$x_2$。</p>
<p>但是，在实际情况中，这样做的难度很大，因为我们很难对所有的电影给出相关特征的评分。而且通常情况，我们还希望能得到除了这两个特征之外的其他特征。</p>
<p>为了能做到这一点，我们换一种形式，假设我们并不知道每部电影具体的特征值是多少：</p>
<table>
<thead>
<tr>
<th style="text-align:center">电影</th>
<th style="text-align:center">Alice(1)</th>
<th style="text-align:center">Bob(2)</th>
<th style="text-align:center">Carol(3)</th>
<th style="text-align:center">Dave(4)</th>
<th style="text-align:center">$x_1$(爱情片)</th>
<th style="text-align:center">$x_2$(动作片)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">《爱到最后》</td>
<td style="text-align:center">5</td>
<td style="text-align:center">5</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">?</td>
<td style="text-align:center">?</td>
</tr>
<tr>
<td style="text-align:center">《浪漫永远》</td>
<td style="text-align:center">5</td>
<td style="text-align:center">?</td>
<td style="text-align:center">?</td>
<td style="text-align:center">0</td>
<td style="text-align:center">?</td>
<td style="text-align:center">?</td>
</tr>
<tr>
<td style="text-align:center">《小爱犬》</td>
<td style="text-align:center">?</td>
<td style="text-align:center">4</td>
<td style="text-align:center">0</td>
<td style="text-align:center">?</td>
<td style="text-align:center">?</td>
<td style="text-align:center">?</td>
</tr>
<tr>
<td style="text-align:center">《无尽狂飙》</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">5</td>
<td style="text-align:center">4</td>
<td style="text-align:center">?</td>
<td style="text-align:center">?</td>
</tr>
<tr>
<td style="text-align:center">《剑与空手道》</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">5</td>
<td style="text-align:center">?</td>
<td style="text-align:center">?</td>
<td style="text-align:center">?</td>
</tr>
</tbody>
</table>
<p>假设我们采访了每一位用户，而且每一位用户都告诉我们他们是否喜欢爱情电影；以及他们是否喜欢动作电影，这样Alice、Bob、Carol以及Dave就有了他们对应的参数：</p>
<table>
<thead>
<tr>
<th style="text-align:center">Alice(1)</th>
<th style="text-align:center">Bob(2)</th>
<th style="text-align:center">Carol(3)</th>
<th style="text-align:center">Dave(4)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$\begin{equation}\theta^{(1)}=\left[\begin{matrix}0\\5\\0\end{matrix}\right]\end{equation}$</td>
<td style="text-align:center">$\begin{equation}\theta^{(2)}=\left[\begin{matrix}0\\5\\0\end{matrix}\right]\end{equation}$</td>
<td style="text-align:center">$\begin{equation}\theta^{(3)}=\left[\begin{matrix}0\\0\\5\end{matrix}\right]\end{equation}$</td>
<td style="text-align:center">$\begin{equation}\theta^{(4)}=\left[\begin{matrix}0\\0\\5\end{matrix}\right]\end{equation}$</td>
</tr>
</tbody>
</table>
<p>每个特征向量的第二个元素表示对爱情片的喜欢程度，第三个元素表示对动作片的喜欢程度。可以看出来Alice和Bob更喜欢爱情片，而Carol和Dave更喜欢动作片。</p>
<p>有了这些数据，我们就可以着眼于用户，看看任意用户$j$对应的不同题材电影的喜欢程度$\theta^{(j)}$。有了这些参数值，理论上我们就能推测出每部电影的特征变量$x_1$和$x_2$的值。</p>
<p>举个例子：</p>
<p>我们看第一个电影，假设我们不知道这部电影的主要内容，我们只知道Alice和Bob喜欢这部电影，而Carol和Dave不喜欢它。从他们四个人的特征向量就可以看出，Alice和Bob给出了5分，而Carol和Dave给出了0分。因此我们可以推断，这部电影可能是一部爱情片，而不太可也能是动作片。所以可能$x_1=1.0$而$x_2=0.0$。</p>
<p>其实这说明了我们在寻找能使得以下式子成立的$x^{(1)}$：</p>
<p>$$<br>(\theta^{(1)})^Tx^{(1)}≈5 \\<br>(\theta^{(2)})^Tx^{(1)}≈5 \\<br>(\theta^{(3)})^Tx^{(1)}≈0 \\<br>(\theta^{(4)})^Tx^{(1)}≈0<br>$$</p>
<p>因此，我们可以得出$x^{(1)}$的值为：</p>
<p>$$<br>\begin{equation}<br>x^{(1)}<br>=\left[<br>\begin{matrix}<br>1\\<br>1.0\\<br>0.0<br>\end{matrix}<br>\right]<br>\end{equation}<br>$$</p>
<blockquote>
<p>第一个元素$x^{(1)}_0$是截距。</p>
</blockquote>
<p>我们可以按照这种方式把其他电影的特征预测出来。</p>
<h3 id="协同过滤算法的正式描述"><a href="#协同过滤算法的正式描述" class="headerlink" title="协同过滤算法的正式描述"></a>协同过滤算法的正式描述</h3><p><strong>优化算法：</strong></p>
<p>在已知给定参数$\theta^{(1)},…,\theta^{(n_u)}$的情况下，对下面函数最小化，得到特征值$x^{(i)}$：</p>
<p><img src="/img/17_05_28/007.gif" alt=""></p>
<p>这就是我们如何从一部特定的电影中学习到特征的方法。</p>
<p>那么对于所有的电影，计算所有的特征，我们通过最小化下面的函数可以得到：</p>
<p><img src="/img/17_05_28/008.gif" alt=""></p>
<p>这里我们对所有$n_m$个电影的特征代价函数求和，然后最小化这个整体的代价函数，这样就能得到针对所有电影的合理的特征值了。</p>
<h3 id="鸡生蛋？蛋生鸡？"><a href="#鸡生蛋？蛋生鸡？" class="headerlink" title="鸡生蛋？蛋生鸡？"></a>鸡生蛋？蛋生鸡？</h3><p>在上一节中，我们提到了如果给定了一系列的特征值$x^{(1)},…,x^{(n_m)}$，以及用户对电影的评分，我们就可以得到不同用户对应的参数向量$\theta^{(1)},…,\theta^{(n_u)}$。</p>
<p>在本节内容中，我们又讲到了在给定参数$\theta^{(1)},…,\theta^{(n_u)}$的情况下，我们可以预测每个电影的特征向量$x^{(1)},…,x^{(n_m)}$。</p>
<p>这有点类似<strong>先有鸡还是先有蛋</strong>的问题。我们知道了$x$就能预测出$\theta$，反之，如果我们知道了$\theta$，我们就能预测出$x$。</p>
<p>这样一来，我们能做到的就是首先随机初始化参数向量$\theta$，然后根据这些初始化得到的$\theta$来得到不同电影的特征值$x$:</p>
<p>$$<br>Guess \ \ \ \ \theta → x<br>$$</p>
<p>有了这些特征值$x$，我们就可以得到对参数$\theta$更好的估计：</p>
<p>$$<br>x → \theta<br>$$</p>
<p>同样，我们可以根据这个更好的$\theta$来得到更好的特征集$x$：</p>
<p>$$<br>\theta → x<br>$$</p>
<p>如此循环往复。</p>
<p>如果你一直重复上述的计算过程，你的算法将会收敛到一组合理的特征值$x$，以及一组合理的对不同用户参数的估计值$\theta$。</p>
<p>这就是基本的<strong>协同过滤算法</strong>，但这实际上不是我们最终使用的算法。在下一节中，我们将改进这个算法，让其在计算时更为高效。但这节课希望能让你基本了解这个算法的基本原理。</p>
<blockquote>
<p>总结一下，在本节，我们了解了最基本的协同过滤算法。</p>
<p>协同过滤算法指的是当你针对一大批用户数据执行这个算法时，这些用户实际上在高效地进行了协同合作来得到每个人对电影的评分值。只要用户对某几部电影进行评分，每个用户就都在帮助算法更好的学习出特征。这样以来，通过自己对几部电影评分之后，我就能帮助系统更好的学习到特征。这些特征可以被系统运用，为其他人做出更准确的电影预测。</p>
<p>协同的另一层意思是说每位用户都在为了大家的利益，而学习出更好的特征。这就是协同过滤。</p>
</blockquote>
<h2 id="协同过滤算法"><a href="#协同过滤算法" class="headerlink" title="协同过滤算法"></a>协同过滤算法</h2><p><a href="https://www.coursera.org/learn/machine-learning/lecture/f26nH/collaborative-filtering-algorithm" target="_blank" rel="external">视频地址</a></p>
<blockquote>
<p>在前几节中，我们谈到几个概念。</p>
<p>首先，如果给你几个特征表示电影，我们可以使用这些资料去获得用户的参数数据。</p>
<p>第二，如果给你用户的参数数据，你可以使用这些资料去获得电影的特征。</p>
<p>本节中，我们将会使用这些概念，并且将它们合并成<strong>协同过滤算法 (Collaborative Filtering Algorithm)</strong>。</p>
</blockquote>
<p>在之前的内容中，我们介绍了通过最小化以下目标函数，来在已知电影特征向量$x^{(1)},…,x^{(n_m)}$的情况下，预测每个用户对应的参数向量$\theta^{(1)},…,\theta^{(n_u)}$：</p>
<p><img src="/img/17_05_28/004.gif" alt=""></p>
<p>也介绍了通过最小化以下目标函数，来在已知每个用户参数向量$\theta^{(1)},…,\theta^{(n_u)}$的情况下，来预测每个电影的特征向量$x^{(1)},…,x^{(n_m)}$：</p>
<p><img src="/img/17_05_28/008.gif" alt=""></p>
<p>我们首先通过随机初始化一组参数$\theta$，然后来推导特征向量$x$；有了特征向量$x$，我们再去反推更好的参数向量$\theta$，然后如此循环往复，直到收敛。</p>
<p>而实际上，我们有一个更有效率的算法，让我们不必再这样不停地来回计算，而是能同时把$x$和$\theta$同时计算出来。</p>
<p>我们做的就是把上面两个式子合而为一：</p>
<p>同时最小化$x^{(1)},…,x^{(n_m)}$和$\theta^{(1)},…,\theta^{(n_u)}$：</p>
<p><img src="/img/17_05_28/009.gif" alt=""></p>
<p>优化目标函数：</p>
<p><img src="/img/17_05_28/010.gif" alt=""></p>
<h3 id="公式解读"><a href="#公式解读" class="headerlink" title="公式解读"></a>公式解读</h3><p>接下来，我们对上面这个式子的推导过程进行详细的解读。</p>
<h4 id="求和部分"><a href="#求和部分" class="headerlink" title="求和部分"></a>求和部分</h4><p>首先需要说明的是，在之前的这两个式子中：</p>
<p><img src="/img/17_05_28/004.gif" alt=""></p>
<p><img src="/img/17_05_28/008.gif" alt=""></p>
<p>仔细观察这两部分，其实是一样的：</p>
<p><img src="/img/17_05_28/011.gif" alt=""></p>
<p><img src="/img/17_05_28/012.gif" alt=""></p>
<p>第一个是：所有的用户的评过分的电影中，预测评分和真实评分的差值平方总和。</p>
<p>第二个是：所有的电影中对它评过分的用户，预测的评分和真实评分的差值平方总和。</p>
<p>这两者的计算结果其实是一样的，只不过条件先后不同导致计算顺序不同而已。</p>
<p>因此，在最终的代价函数中：</p>
<p><img src="/img/17_05_28/009.gif" alt=""></p>
<p>这一部分：</p>
<p><img src="/img/17_05_28/013.gif" alt=""></p>
<p>其实这个表达式就是上面那两种表达式的整体的表示形式。计算结果与上面那两个式子也是相同的。</p>
<h4 id="正则化部分"><a href="#正则化部分" class="headerlink" title="正则化部分"></a>正则化部分</h4><p>最终的代价函数</p>
<p><img src="/img/17_05_28/009.gif" alt=""></p>
<p>的后半段：</p>
<p><img src="/img/17_05_28/014.gif" alt=""></p>
<p>其实就是把这两个式子中的正则化部分求和得出的：</p>
<p><img src="/img/17_05_28/004.gif" alt=""></p>
<p><img src="/img/17_05_28/008.gif" alt=""></p>
<p>如果你把</p>
<p><img src="/img/17_05_28/009.gif" alt=""></p>
<p>中$x^{(1)},…,x^{(n_m)}$部分看做是常数，然后关于$\theta$做优化，那么这个式子其实就相当于：</p>
<p><img src="/img/17_05_28/004.gif" alt=""></p>
<p>反之，如果你把$\theta^{(1)},…,\theta^{(n_u)}$部分看做常数，然后关于$x$做优化，那么这个式子其实就相当于是：</p>
<p><img src="/img/17_05_28/008.gif" alt=""></p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>最终，我们通过合并之前的两个式子，得到了同时关于$x$和$\theta$的代价函数表达式：</p>
<p><img src="/img/17_05_28/009.gif" alt=""><br><img src="/img/17_05_28/010.gif" alt=""></p>
<p>这和之前的算法之间唯一的不同就是<strong>不需要反复计算</strong>（就是前面提到的先关于$\theta$最小化，然后再关于$x$最小化，然后再次关于$\theta$最小化，反复直到收敛）。在新版本里头 不需要不断地在$x$和$θ$这两个参数之间不停折腾，我们所要做的是将这两组参数同时化简。</p>
<h4 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h4><p>最后值得提醒的一件事，当我们以这样的方法学习特征量时，我们必须要保证去掉$x_0$项，这样来保证我们学习到的特征量$x$是$n$维的，而不是$n+1$维的。</p>
<p>同样地，因为参数$θ$与特征向量$x$是在同一个维度上，所以$θ$也是$n$维的。因为如果没有$x_0$，那么$θ_0$也不再需要。</p>
<h3 id="协同过滤算法的正式描述-1"><a href="#协同过滤算法的正式描述-1" class="headerlink" title="协同过滤算法的正式描述"></a>协同过滤算法的正式描述</h3><p>把上面所有的过程总结下来，就是所谓的<strong>协同过滤算法</strong>。下面是对这一算法的具体步骤描述：</p>
<ul>
<li>1.首先用较小的初始值来随机初始化参数$x^{(1)},…,x^{(n_m)},\theta^{(1)},…,\theta^{(n_u)}$。<blockquote>
<p>这一步有点像训练神经网络，在神经网络中的训练中，我们也是用小的随机数来初始化权值。</p>
</blockquote>
</li>
<li>2.通过使用梯度下降算法（或者其他更高级的优化算法）来最小化代价函数$J(x^{(1)},…,x^{(n_m)},\theta^{(1)},…,\theta^{(n_u)})$。<ul>
<li>例如循环每一个$j=1,…,n_u,i=1,…,n_m$ 来执行对应的梯度下降：</li>
</ul>
</li>
</ul>
<p><img src="/img/17_05_28/015.png" alt=""></p>
<p>其中这一部分：</p>
<p><img src="/img/17_05_28/016.png" alt=""></p>
<p>就是对代价函数的偏微分项：</p>
<p>$$<br>\frac{\partial}{\partial x_k^{(i)}}<br>J(x^{(1)},…,x^{(n_m)})<br>$$</p>
<p>这一部分：</p>
<p><img src="/img/17_05_28/017.png" alt=""></p>
<p>对应也是下面这个代价函数的偏微分项：</p>
<p>$$<br>\frac{\partial}{\partial \theta_k^{(j)}}<br>J(\theta^{(1)},…,\theta^{(n_u)})<br>$$</p>
<blockquote>
<p>值得提醒的是，在这个公式中，我们不再用到$x_0=1$这一项，因此$x$是$n$维的（$x\in R^n$）而不是$n+1$维；$\theta$也是$n$维（$\theta\in R^n$）。</p>
<p>所以我们在做正则化的时候，也是对这$n$维的参数进行正则化，并不包括$x_0$和$\theta_0$。</p>
</blockquote>
<ul>
<li>3.最终，通过用户对应的参数向量$\theta$和训练得出的特征向量$x$，来预测用户给出的评分$\theta^Tx$。</li>
</ul>
<h1 id="低秩矩阵分解"><a href="#低秩矩阵分解" class="headerlink" title="低秩矩阵分解"></a>低秩矩阵分解</h1><h2 id="矢量化：低秩矩阵分解"><a href="#矢量化：低秩矩阵分解" class="headerlink" title="矢量化：低秩矩阵分解"></a>矢量化：低秩矩阵分解</h2><p><a href="https://www.coursera.org/learn/machine-learning/lecture/CEXN0/vectorization-low-rank-matrix-factorization" target="_blank" rel="external">视频地址</a></p>
<blockquote>
<p>在上几节中，我们谈到了<strong>协同过滤算法</strong>，本节视频中我将会讲到有关该算法的向量化实现，以及说说有关该算法你可以做的其他事情。</p>
<p>比如说，你可以做到<strong>相似产品推荐</strong>的功能。</p>
</blockquote>
<p>还是以之前的电影评分为例：</p>
<table>
<thead>
<tr>
<th style="text-align:center">电影</th>
<th style="text-align:center">Alice(1)</th>
<th style="text-align:center">Bob(2)</th>
<th style="text-align:center">Carol(3)</th>
<th style="text-align:center">Dave(4)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">《爱到最后》</td>
<td style="text-align:center">5</td>
<td style="text-align:center">5</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">《浪漫永远》</td>
<td style="text-align:center">5</td>
<td style="text-align:center">?</td>
<td style="text-align:center">?</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">《小爱犬》</td>
<td style="text-align:center">?</td>
<td style="text-align:center">4</td>
<td style="text-align:center">0</td>
<td style="text-align:center">?</td>
</tr>
<tr>
<td style="text-align:center">《无尽狂飙》</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">5</td>
<td style="text-align:center">4</td>
</tr>
<tr>
<td style="text-align:center">《剑与空手道》</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">5</td>
<td style="text-align:center">?</td>
</tr>
</tbody>
</table>
<p>我们将这些数据存储到矩阵$Y$中：</p>
<p>$$<br>\begin{equation}<br>Y=\left[<br>\begin{matrix}<br>5&amp;5&amp;0&amp;0\\<br>5&amp;?&amp;?&amp;0\\<br>?&amp;4&amp;0&amp;?\\<br>0&amp;0&amp;5&amp;4\\<br>0&amp;0&amp;5&amp;0<br>\end{matrix}<br>\right]<br>\end{equation}<br>$$</p>
<p>$Y^{(i,j)}$代表第i行第j列的数据，即第i部电影的第j个用户的评分。</p>
<p>同时，我们也可以得出下面这个预测评分矩阵：</p>
<p>$$<br>\begin{equation}<br>\left[<br>\begin{matrix}<br>(\theta^{(1)})^T(x^{(1)})&amp;(\theta^{(2)})^T(x^{(1)})&amp;…&amp;(\theta^{(n_u)})^T(x^{(1)})\\<br>(\theta^{(1)})^T(x^{(2)})&amp;(\theta^{(2)})^T(x^{(2)})&amp;…&amp;(\theta^{(n_u)})^T(x^{(2)})\\<br>┋&amp;┋&amp;┋&amp;┋\\<br>(\theta^{(1)})^T(x^{(n_m)})&amp;(\theta^{(2)})^T(x^{(n_m)})&amp;…&amp;(\theta^{(n_u)})^T(x^{(n_m)})<br>\end{matrix}<br>\right]<br>\end{equation}<br>$$</p>
<p>其中$(\theta^{(j)})^T(x^{(i)})$代表第i个电影中第j个用户，预计给出的评分。</p>
<p>这个预测矩阵可以看做是<strong>电影的特征矩阵</strong>和<strong>用户的参数矩阵的转置</strong>的乘积。</p>
<p>电影特征矩阵如下：</p>
<p>$$<br>\begin{equation}<br>X=\left[<br>\begin{matrix}<br>(x^{(1)})^T\\<br>(x^{(2)})^T\\<br>┋\\<br>(x^{(n_m)})^T<br>\end{matrix}<br>\right]<br>\end{equation}<br>$$</p>
<p>其中每一个元素都是一部电影的特征向量。</p>
<p>用户的参数矩阵如下：</p>
<p>$$<br>\begin{equation}<br>\Theta=\left[<br>\begin{matrix}<br>(\theta^{(1)})^T\\<br>(\theta^{(2)})^T\\<br>┋\\<br>(\theta^{(n_u)})^T<br>\end{matrix}<br>\right]<br>\end{equation}<br>$$</p>
<p>其中每个元素都是一个用户的参数向量。</p>
<p>有了所有电影的特征矩阵$X$和所有用户的参数矩阵$\Theta$后，我们就可以得到上面的预测矩阵了：</p>
<p>$$<br>\begin{equation}<br>X\Theta^T=\left[<br>\begin{matrix}<br>(\theta^{(1)})^T(x^{(1)})&amp;(\theta^{(2)})^T(x^{(1)})&amp;…&amp;(\theta^{(n_u)})^T(x^{(1)})\\<br>(\theta^{(1)})^T(x^{(2)})&amp;(\theta^{(2)})^T(x^{(2)})&amp;…&amp;(\theta^{(n_u)})^T(x^{(2)})\\<br>┋&amp;┋&amp;┋&amp;┋\\<br>(\theta^{(1)})^T(x^{(n_m)})&amp;(\theta^{(2)})^T(x^{(n_m)})&amp;…&amp;(\theta^{(n_u)})^T(x^{(n_m)})<br>\end{matrix}<br>\right]<br>\end{equation}<br>$$</p>
<blockquote>
<p>我们的协同过滤算法还有另外一个名字：<strong>低秩矩阵分解（Low Rank Matrix Factorization）</strong>。</p>
</blockquote>
<h3 id="其他功能"><a href="#其他功能" class="headerlink" title="其他功能"></a>其他功能</h3><p>最后，我们还可以通过使用协同过滤算法产生的结果做一些额外的事情。比如说<strong>找到相关的电影</strong>。</p>
<p>如何做到针对用户喜欢的某一部电影，然后推荐给他另一部类似的电影呢？</p>
<p>对于每一部电影，我们都可以学习到他的特征向量$x^{(i)} \in R^n$。</p>
<p>假设我们想找到和电影$i$最类似的一部电影，有一种方式就是求出所有电影的特征向量，然后和电影$i$的特征向量求欧氏距离，距离最小的那个就是最类似的：</p>
<p>$$<br>Small ||x^{(i)}-x^{(j)}||  → 电影i和电影j最类似<br>$$</p>
<p>类似的，如果你想找到与电影$i$最类似的5部电影，你只需求与特征向量$x^{(i)}$欧式距离最小的五部电影即可。</p>
<h2 id="实现细节：均值归一化"><a href="#实现细节：均值归一化" class="headerlink" title="实现细节：均值归一化"></a>实现细节：均值归一化</h2><p><a href="https://www.coursera.org/learn/machine-learning/lecture/Adk8G/implementational-detail-mean-normalization" target="_blank" rel="external">视频地址</a></p>
<blockquote>
<p>到目前为止，你已经了解到了推荐系统算法或者 协同过滤算法的所有要点。</p>
<p>在本节中，我想分享最后一点实现过程中的细节，这一点就是<strong>均值归一化</strong>。有时它可以让算法运行得更好。</p>
</blockquote>
<h3 id="动机"><a href="#动机" class="headerlink" title="动机"></a>动机</h3><p>为了了解均值归一化这个想法的动机，我们考虑这样一个例子。</p>
<p>有一个用户Eve没有给任何电影评分：</p>
<table>
<thead>
<tr>
<th style="text-align:center">电影</th>
<th style="text-align:center">Alice(1)</th>
<th style="text-align:center">Bob(2)</th>
<th style="text-align:center">Carol(3)</th>
<th style="text-align:center">Dave(4)</th>
<th style="text-align:center">Eve(5)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">《爱到最后》</td>
<td style="text-align:center">5</td>
<td style="text-align:center">5</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center"><strong>?</strong></td>
</tr>
<tr>
<td style="text-align:center">《浪漫永远》</td>
<td style="text-align:center">5</td>
<td style="text-align:center">?</td>
<td style="text-align:center">?</td>
<td style="text-align:center">0</td>
<td style="text-align:center"><strong>?</strong></td>
</tr>
<tr>
<td style="text-align:center">《小爱犬》</td>
<td style="text-align:center">?</td>
<td style="text-align:center">4</td>
<td style="text-align:center">0</td>
<td style="text-align:center">?</td>
<td style="text-align:center"><strong>?</strong></td>
</tr>
<tr>
<td style="text-align:center">《无尽狂飙》</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">5</td>
<td style="text-align:center">4</td>
<td style="text-align:center"><strong>?</strong></td>
</tr>
<tr>
<td style="text-align:center">《剑与空手道》</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">5</td>
<td style="text-align:center">?</td>
<td style="text-align:center"><strong>?</strong></td>
</tr>
</tbody>
</table>
<p>$$<br>\begin{equation}<br>Y=\left[<br>\begin{matrix}<br>5&amp;5&amp;0&amp;0&amp;?\\<br>5&amp;?&amp;?&amp;0&amp;?\\<br>?&amp;4&amp;0&amp;?&amp;?\\<br>0&amp;0&amp;5&amp;4&amp;?\\<br>0&amp;0&amp;5&amp;0&amp;?<br>\end{matrix}<br>\right]<br>\end{equation}<br>$$</p>
<p>我们来看看协同过滤算法会对这个用户做什么。</p>
<p>假设我们的电影只有两个特征$n=2$，用户的参数向量也是2维的：$\theta^{(5)} \in R^2$。</p>
<p><img src="/img/17_05_28/009.gif" alt=""></p>
<p>由于用户没有给任何电影评分，因此代价函数的前半部分没有任何电影满足$r(i,j)=1$的条件，所以可以忽略。所以，真正影响代价函数值变化的只有这一项：</p>
<p>$$<br>\frac{\lambda}{2}<br>\sum_{j=1}^{n_u}<br>\sum_{k=1}^{n}<br>(\theta_k^{(j)})^2<br>$$</p>
<p>对应到我们的具体的两个特征上之后，就是如下的形式：</p>
<p>$$<br>\frac{\lambda}{2}<br>[<br>(\theta_1^{(5)})^2+(\theta_2^{(5)})^2<br>]<br>$$</p>
<p>因此，为了最小化这一项，我们得到的结果就是：</p>
<p>$$<br>\begin{equation}<br>\theta^{(5)}=\left[<br>\begin{matrix}<br>0\\<br>0<br>\end{matrix}<br>\right]<br>\end{equation}<br>$$</p>
<p>所以，我们可以得出用户对电影评分的预测结果：</p>
<p>$$<br>(\theta^{(5)})^Tx^{(1)}=0<br>$$</p>
<p>都是0颗星。</p>
<p>这个结果看起来并没有什么用，因为其实有的电影是对于某些人来说是有较高的评分的，所以某些电影是值得被推荐的。但是我们得到的预测结果都是0颗星，这个结果在暗示我们不要推荐电影给他，这其实也不够好。</p>
<p>所以，我们需要引入<strong>均值归一化</strong>来解决我们这个问题。</p>
<h3 id="均值归一化处理数据"><a href="#均值归一化处理数据" class="headerlink" title="均值归一化处理数据"></a>均值归一化处理数据</h3><p>对于已知的电影评分数据：</p>
<p>$$<br>\begin{equation}<br>Y=\left[<br>\begin{matrix}<br>5&amp;5&amp;0&amp;0&amp;?\\<br>5&amp;?&amp;?&amp;0&amp;?\\<br>?&amp;4&amp;0&amp;?&amp;?\\<br>0&amp;0&amp;5&amp;4&amp;?\\<br>0&amp;0&amp;5&amp;0&amp;?<br>\end{matrix}<br>\right]<br>\end{equation}<br>$$</p>
<p>我们要做的就是计算每个电影所得评分的均值，用向量$μ$表示：</p>
<p>$$<br>\begin{equation}<br>μ=\left[<br>\begin{matrix}<br>2.5\\<br>2.5\\<br>2\\<br>2.25\\<br>1.25<br>\end{matrix}<br>\right]<br>\end{equation}<br>$$</p>
<p>然后将所有评分减去平均评分，得到新的$Y$：</p>
<p>$$<br>\begin{equation}<br>Y=\left[<br>\begin{matrix}<br>2.5&amp;2.5&amp;-2.5&amp;-2.5&amp;?\\<br>2.5&amp;?&amp;?&amp;-2.5&amp;?\\<br>?&amp;2&amp;-2&amp;?&amp;?\\<br>-2.25&amp;-2.25&amp;2.75&amp;1.75&amp;?\\<br>-1.25&amp;-1.25&amp;3.75&amp;-1.25&amp;?<br>\end{matrix}<br>\right]<br>\end{equation}<br>$$</p>
<p>这样做的目的，<strong>就是把每部电影的评分的平均数都调整为0</strong>。</p>
<p>然后我们对经过归一化处理之后的矩阵使用协同过滤算法，即使用户没有对电影做出过评分，那么我们得到的参数向量是：</p>
<p>$$<br>\begin{equation}<br>\theta^{(5)}=\left[<br>\begin{matrix}<br>0\\<br>0<br>\end{matrix}<br>\right]<br>\end{equation}<br>$$</p>
<p>我们最终预测用户给出的分值是：</p>
<p>$$<br>(\theta^{(5)})^Tx^{(1)} + μ_i<br>$$</p>
<p>在这个例子中，我们预测Eva对五部电影初始化的评分分别为：2.5，2.5，2，2.25，1.25。</p>
<p>因为：</p>
<p>$$<br>\begin{equation}<br>μ=\left[<br>\begin{matrix}<br>2.5\\<br>2.5\\<br>2\\<br>2.25\\<br>1.25<br>\end{matrix}<br>\right]<br>\end{equation}<br>$$</p>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/img/common/weixin.jpeg" alt="DannyLee1991 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/img/common/alipay.jpeg" alt="DannyLee1991 支付宝"/>
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/机器学习/" rel="tag"># 机器学习</a>
          
            <a href="/tags/斯坦福课程/" rel="tag"># 斯坦福课程</a>
          
        </div>
      

      
      
        <div class="post-widgets">
        

        

        
          
          <div id="needsharebutton-postbottom">
            <span class="btn">
              <i class="fa fa-share-alt" aria-hidden="true"></i>
            </span>
          </div>
        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/05/26/斯坦福机器学习课程 第九周 (3)多元高斯分布（选学）/" rel="next" title="斯坦福机器学习课程 第九周 (3)多元高斯分布（选学）">
                <i class="fa fa-chevron-left"></i> 斯坦福机器学习课程 第九周 (3)多元高斯分布（选学）
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/06/01/斯坦福机器学习课程 第十周 (1)大数据集梯度下降/" rel="prev" title="斯坦福机器学习课程 第十周 (1)大数据集梯度下降">
                斯坦福机器学习课程 第十周 (1)大数据集梯度下降 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="uyan_frame"></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="DannyLee1991" />
            
              <p class="site-author-name" itemprop="name">DannyLee1991</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">122</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">17</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">20</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/rss2.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/DannyLee1991" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:747554505@qq.com" target="_blank" title="E-Mail">
                    
                      <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="tencent://message/?Menu=yes&uin=747554505" target="_blank" title="QQ">
                    
                      <i class="fa fa-fw fa-qq"></i>QQ</a>
                </span>
              
            
          </div>

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#预测电影评分"><span class="nav-number">1.</span> <span class="nav-text">预测电影评分</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#问题制定"><span class="nav-number">1.1.</span> <span class="nav-text">问题制定</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#推荐系统-问题表述"><span class="nav-number">1.1.1.</span> <span class="nav-text">推荐系统 问题表述</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#基于内容的推荐"><span class="nav-number">1.2.</span> <span class="nav-text">基于内容的推荐</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用一个已经训练好的模型进行预测"><span class="nav-number">1.2.1.</span> <span class="nav-text">使用一个已经训练好的模型进行预测</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#举例"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">举例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#更正式的描述"><span class="nav-number">1.2.2.</span> <span class="nav-text">更正式的描述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#训练预测模型：计算参数向量-theta"><span class="nav-number">1.2.3.</span> <span class="nav-text">训练预测模型：计算参数向量$\theta$</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#完整的描述"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">完整的描述</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#优化目标"><span class="nav-number">1.2.3.1.1.</span> <span class="nav-text">优化目标</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#优化算法"><span class="nav-number">1.2.3.1.2.</span> <span class="nav-text">优化算法</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#协同过滤"><span class="nav-number">2.</span> <span class="nav-text">协同过滤</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#协同过滤-1"><span class="nav-number">2.1.</span> <span class="nav-text">协同过滤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#协同过滤算法的正式描述"><span class="nav-number">2.1.1.</span> <span class="nav-text">协同过滤算法的正式描述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#鸡生蛋？蛋生鸡？"><span class="nav-number">2.1.2.</span> <span class="nav-text">鸡生蛋？蛋生鸡？</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#协同过滤算法"><span class="nav-number">2.2.</span> <span class="nav-text">协同过滤算法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#公式解读"><span class="nav-number">2.2.1.</span> <span class="nav-text">公式解读</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#求和部分"><span class="nav-number">2.2.1.1.</span> <span class="nav-text">求和部分</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#正则化部分"><span class="nav-number">2.2.1.2.</span> <span class="nav-text">正则化部分</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结"><span class="nav-number">2.2.1.3.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#注意点"><span class="nav-number">2.2.1.4.</span> <span class="nav-text">注意点</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#协同过滤算法的正式描述-1"><span class="nav-number">2.2.2.</span> <span class="nav-text">协同过滤算法的正式描述</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#低秩矩阵分解"><span class="nav-number">3.</span> <span class="nav-text">低秩矩阵分解</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#矢量化：低秩矩阵分解"><span class="nav-number">3.1.</span> <span class="nav-text">矢量化：低秩矩阵分解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#其他功能"><span class="nav-number">3.1.1.</span> <span class="nav-text">其他功能</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实现细节：均值归一化"><span class="nav-number">3.2.</span> <span class="nav-text">实现细节：均值归一化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#动机"><span class="nav-number">3.2.1.</span> <span class="nav-text">动机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#均值归一化处理数据"><span class="nav-number">3.2.2.</span> <span class="nav-text">均值归一化处理数据</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">DannyLee1991</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  
    

    
      <!-- UY BEGIN -->
      <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2147750"></script>
      <!-- UY END -->
    
  





  












  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("IWEvQRPkbA9LAxFxX7cAc8NU-gzGzoHsz", "MwlyXFF4VkWlbJ0lBGzlTmTA");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  
  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">

  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>

  <script>
    
      pbOptions = {};
      
          pbOptions.iconStyle = "default";
      
          pbOptions.boxForm = "horizontal";
      
          pbOptions.position = "bottomCenter";
      
          pbOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
  </script>

  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

  

</body>
</html>
